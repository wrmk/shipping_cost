<%= form_with do |form| %>

  <div class="form-group w-25 p-3">
    <label> Длина, м </label>
    <%= form.text_field :length,class:"form-control", onchange:"validate(this)" %>
    <label> Ширина, м </label>
    <%= form.text_field :width,class:"form-control", onchange:"validate(this)" %>
    <label> Высота, м </label>
    <%= form.text_field :height,class:"form-control", onchange:"validate(this)" %>
    <label> Объём, м³ </label>
    <%= form.text_field :volume,class:"form-control", onchange:"validate(this)" %>
    <label> Город отправки </label>
    <%= form.text_field :departure,class:"form-control", id:"departure" %>
    <label> Город доставки </label>
    <%= form.text_field :destination,class:"form-control", id:"destination", onchange: "get_distance()" %>
    <label> Расстояние, км </label>
    <%= form.text_field :distance,class:"form-control", id:"distance", readonly:true %>
    <%= form.submit 'Рассчитать',class:"btn btn-dark", onsubmit:"calculate()" %>
  </div>

<% end %>


<script>

  $('form').submit(function () {
    let empty_fields = 0;
    $("input[type=text]")
      .each(function(index){
        if (this.value === '') empty_fields ++ ;
      });    
    if(empty_fields > 0) {
       alert('введите все значения для расчёта');
       return false;
    };
  });

  function validate(field){
    if (!isNaN(+field.value) && +field.value != 0){
    } else {
      alert('введите число');
      field.value = ''
    }
  };

  function get_distance(){
    ymaps.ready(function(){
      var departure = document.getElementById("departure");
      var destination = document.getElementById("destination");

      ymaps.route([departure.value,destination.value])
        .then(function(route){
          var distance = route.getLength();
          set_distance(Math.round(distance/1000));
        })
        .catch (function(error) {
          alert('введите корректные названия городов');
          departure.value = '';
          destination.value = '';
        });
    });    
  }

  function set_distance(distance){
    document.getElementById("distance").value = distance;
  }

</script>